import QRCodeStyling from 'qr-code-styling';
import { AsyncSubject } from 'rxjs';
import { Templates } from './ngx-qrcode-styling.templates';
/**
 * drawQrcode
 * @param config
 * @param container
 * @returns
 */
export function drawQrcode(config, container) {
    const subject = new AsyncSubject();
    // Reject
    if (!config || !container) {
        subject.error('Container or Config not available!');
        subject.complete();
        return subject;
    }
    ;
    const element = document.createElement("div");
    /**
     * QRCODE_NONE_FRAME
     * @returns
     */
    const QRCODE_NONE_FRAME = () => {
        if (config?.frameOptions) {
            return false;
        }
        else {
            const encodeConfig = () => {
                let deep = config && JSON.parse(JSON.stringify(config)); // deep
                return Object.assign({ data: window.unescape(encodeURIComponent(deep?.data ?? '')) }, deep);
            };
            // removeChild
            while (container.firstChild) {
                container.removeChild(container.lastChild);
            }
            const CR = new QRCodeStyling(encodeConfig());
            // append to container
            CR.append(container);
            return true;
        }
    };
    const styleName = config?.frameOptions?.style ?? 'F_020';
    const height = config?.frameOptions?.height ?? 300;
    const width = config?.frameOptions?.width ?? 300;
    const x = config?.frameOptions?.x ?? 50;
    const y = config?.frameOptions?.y ?? 50;
    /**
     * ADD_FRAME_SVG_TO_ELEMENT
     * @returns
     */
    const ADD_FRAME_SVG_TO_ELEMENT = () => {
        const http = fetch(`https://raw.githubusercontent.com/id1945/ngx-qrcode-styling/master/svg/${styleName}.svg`, { method: 'GET' });
        return new Promise((resolve, reject) => {
            http.then(response => response.text()).then(result => {
                if (result !== "404: Not Found") {
                    upgradeSvg(result);
                }
                resolve(result);
            }).catch(error => {
                console.error(error);
                reject(error);
            });
        });
    };
    const upgradeSvg = (result) => {
        const parser = new DOMParser();
        const doc = parser.parseFromString(result, "image/svg+xml");
        if (doc) {
            const svgEl = doc.documentElement.children[styleName + '_svg'];
            if (!svgEl)
                return;
            const textEls = svgEl.getElementsByClassName("frame-text");
            const contentEls = svgEl.getElementsByClassName("frame-content");
            const containerEls = svgEl.getElementsByClassName("frame-container");
            const updateStyle = (el, config) => {
                if (el) {
                    for (const key in config) {
                        if (['x', 'y', 'transform'].includes(key)) {
                            el.setAttribute(key, config && config[key]);
                        }
                        else if (['textContent'].includes(key)) {
                            el[key] = config && config[key];
                        }
                        else {
                            el.style[key] = config && config[key];
                        }
                    }
                }
            };
            const createElementNS = (config) => {
                const svgNS = "http://www.w3.org/2000/svg";
                const newText = document.createElementNS(svgNS, "text");
                updateStyle(newText, config);
                svgEl.appendChild(newText);
            };
            if (config?.frameOptions?.texts) {
                [...config.frameOptions.texts].forEach((text, i) => {
                    const el = [...textEls]?.[i];
                    el ? updateStyle(el, text) : createElementNS(text);
                });
            }
            if (config?.frameOptions?.containers) {
                [...containerEls].forEach((el, i) => {
                    updateStyle(el, config?.frameOptions?.containers?.[i]);
                });
            }
            if (config?.frameOptions?.contents) {
                [...contentEls].forEach((el, i) => {
                    updateStyle(el, config?.frameOptions?.contents?.[i]);
                });
            }
            element.appendChild(doc.documentElement);
        }
    };
    /**
     * UPDATE_POSITION_QRCODE_ON_FRAME
     * @returns HTMLElement
     */
    const UPDATE_POSITION_QRCODE_ON_FRAME = () => {
        const addsvg = element.querySelector('.addsvg');
        addsvg?.setAttribute("transform", `translate(${x},${y})`);
        return addsvg;
    };
    /**
     * UPDATE_ROTATE_SCALE_QRCODE_ON_FRAME
     * @param svg
     * @returns void
     */
    const UPDATE_ROTATE_SCALE_QRCODE_ON_FRAME = (svg) => {
        if (svg && config?.rotate) {
            svg?.childNodes?.[0]?.childNodes?.forEach((node) => {
                if (node.nodeName === 'rect') {
                    node.style.transformOrigin = `50% 50%`;
                    node.style.transform = `rotate(${config?.rotate ?? 0}deg)`;
                }
            });
        }
        if (svg && config?.scale) {
            svg?.childNodes?.[0]?.childNodes?.forEach((node) => {
                if (node.nodeName === 'rect') {
                    node.style.scale = config?.scale ?? 0;
                }
            });
        }
    };
    /**
     * CREATE_QRCODE_INTO_FRAME
     * @param addsvg
     * @returns
     */
    const CREATE_QRCODE_INTO_FRAME = (addsvg) => {
        const defaultConfig = () => {
            let deep = config && JSON.parse(JSON.stringify(config)); // deep
            deep = { ...deep, ...{ type: 'svg', data: window.unescape(encodeURIComponent(deep?.data ?? '')) } };
            delete deep.frameOptions;
            delete deep.template;
            return deep;
        };
        // removeChild
        while (container?.firstChild) {
            container.removeChild(container.lastChild);
        }
        const CR = new QRCodeStyling(defaultConfig());
        return CR?._svgDrawingPromise?.then(() => {
            CR.append(addsvg);
        }).catch((error) => console.error(error));
    };
    /**
     * QRCODE_TYPE_SVG
     * @returns
     */
    const QRCODE_TYPE_SVG = () => {
        if (config?.type === 'svg') {
            UPDATE_SIZE_SVG();
            container.appendChild(element);
            return true;
        }
        return false;
    };
    /**
     * CREATE_CANVAS_WITH_SIZE
     * @returns
     */
    const CREATE_CANVAS_WITH_SIZE = () => {
        const canvas = document.createElement('canvas');
        canvas.height = height;
        canvas.width = width;
        container.appendChild(canvas);
        return canvas;
    };
    /**
     * ELEMENT_CONVERT_TO_BASE64
     * @param s1
     * @returns
     */
    const ELEMENT_CONVERT_TO_BASE64 = (s1) => {
        let b64 = "data:image/svg+xml;base64,";
        const xml = s1 && new XMLSerializer().serializeToString(s1);
        return b64 += xml && btoa(unescape(encodeURIComponent(xml)));
    };
    /**
     * UPDATE_SIZE_SVG
     * @returns
     */
    const UPDATE_SIZE_SVG = () => {
        const s1 = element.querySelector(`#${styleName}_svg`);
        s1 && s1.setAttribute('height', `${height}px`);
        s1 && s1.setAttribute('width', `${width}px`);
        return s1;
    };
    /**
     * BASE64_TO_BLOB
     * @param base64Image
     * @returns
     */
    const BASE64_TO_BLOB = (base64Image) => {
        // Split into two parts
        const parts = base64Image.split(";base64,");
        // Hold the content type
        const imageType = parts[0].split(":")[1];
        // Decode Base64 string
        const decodedData = window.atob(parts[1]);
        // Create UNIT8ARRAY of size same as row data length
        const uInt8Array = new Uint8Array(decodedData.length);
        // Insert all character code into uInt8Array
        for (let i = 0; i < decodedData.length; ++i) {
            uInt8Array[i] = decodedData.charCodeAt(i);
        }
        // Return BLOB image after conversion
        return new Blob([uInt8Array], { type: imageType });
    };
    /**
     * CREATE_IMAGE
     */
    const CREATE_IMAGE = () => {
        const img = new Image();
        const ctx = CREATE_CANVAS_WITH_SIZE().getContext("2d");
        img.onload = function () {
            ctx && ctx.drawImage(img, 0, 0);
        };
        const blob = BASE64_TO_BLOB(ELEMENT_CONVERT_TO_BASE64(UPDATE_SIZE_SVG()));
        const blobUrl = URL.createObjectURL(blob);
        img.src = blobUrl;
    };
    /**
     * MAIN
     */
    (async function () {
        if (QRCODE_NONE_FRAME()) {
            subject.next({ config, container });
            subject.complete();
            return; // Mode qrcode basic
        }
        else {
            await ADD_FRAME_SVG_TO_ELEMENT();
            const ADDSVG = UPDATE_POSITION_QRCODE_ON_FRAME();
            await CREATE_QRCODE_INTO_FRAME(ADDSVG);
            UPDATE_ROTATE_SCALE_QRCODE_ON_FRAME(ADDSVG);
            if (QRCODE_TYPE_SVG()) {
                // Mode qrcode + frame type svg
                subject.next({ config, container });
                subject.complete();
            }
            else {
                // Mode qrcode + frame type canvas
                CREATE_IMAGE();
                subject.next({ config, container });
                subject.complete();
            }
        }
    })();
    return subject;
}
/**
 * defaultTemplate
 * @param config
 * @returns
 */
export const defaultTemplate = (config) => {
    let deep = config && JSON.parse(JSON.stringify(config));
    return config?.template ? { ...Templates(config.template.toLocaleLowerCase()), ...deep } : deep;
};
/**
 * deepUpdate
 * @param config
 * @param configUpdate
 * @returns
 */
export const deepUpdate = async (config, configUpdate) => {
    const origin = config && JSON.parse(JSON.stringify(config));
    let clone = { ...origin, ...configUpdate };
    const keys = ['frameOptions', 'qrOptions', 'imageOptions', 'dotsOptions', 'cornersSquareOptions', 'cornersDotOptions', 'backgroundOptions'];
    for await (const key of keys) {
        if (key in configUpdate) {
            const update = {
                [key]: { ...origin[key], ...configUpdate[key] }
            };
            clone = { ...clone, ...update };
        }
    }
    return clone;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LXFyY29kZS1zdHlsaW5nLmhlbHBlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Byb2plY3RzL25neC1xcmNvZGUtc3R5bGluZy9zcmMvbGliL25neC1xcmNvZGUtc3R5bGluZy5oZWxwZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxhQUFhLE1BQU0saUJBQWlCLENBQUM7QUFDNUMsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUdwQyxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFFM0Q7Ozs7O0dBS0c7QUFDSCxNQUFNLFVBQVUsVUFBVSxDQUFDLE1BQWUsRUFBRSxTQUFnRjtJQUV4SCxNQUFNLE9BQU8sR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO0lBRW5DLFNBQVM7SUFDVCxJQUFJLENBQUMsTUFBTSxJQUFJLENBQUMsU0FBUyxFQUFFO1FBQ3ZCLE9BQU8sQ0FBQyxLQUFLLENBQUMsb0NBQW9DLENBQUMsQ0FBQztRQUNwRCxPQUFPLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDbkIsT0FBTyxPQUFPLENBQUM7S0FDbEI7SUFBQSxDQUFDO0lBRUYsTUFBTSxPQUFPLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUU5Qzs7O09BR0c7SUFDSCxNQUFNLGlCQUFpQixHQUFHLEdBQUcsRUFBRTtRQUMzQixJQUFJLE1BQU0sRUFBRSxZQUFZLEVBQUU7WUFDdEIsT0FBTyxLQUFLLENBQUM7U0FDaEI7YUFBTTtZQUNILE1BQU0sWUFBWSxHQUFHLEdBQUcsRUFBRTtnQkFDdEIsSUFBSSxJQUFJLEdBQUcsTUFBTSxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTztnQkFDaEUsT0FBTyxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsSUFBSSxFQUFHLE1B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SUFDekYsTUFBTSxNQUFNLEdBQUcsTUFBTSxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO0lBQzVELElBQUksS0FBSyxHQUFHLEVBQUUsR0FBRyxNQUFNLEVBQUUsR0FBRyxZQUFZLEVBQUUsQ0FBQztJQUMzQyxNQUFNLElBQUksR0FBRyxDQUFDLGNBQWMsRUFBRSxXQUFXLEVBQUUsY0FBYyxFQUFFLGFBQWEsRUFBRSxzQkFBc0IsRUFBRSxtQkFBbUIsRUFBRSxtQkFBbUIsQ0FBQyxDQUFDO0lBQzVJLElBQUksS0FBSyxFQUFFLE1BQU0sR0FBRyxJQUFJLElBQUksRUFBRTtRQUMxQixJQUFJLEdBQUcsSUFBSSxZQUFZLEVBQUU7WUFDckIsTUFBTSxNQUFNLEdBQUc7Z0JBQ1gsQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEdBQUksWUFBb0IsQ0FBQyxHQUFHLENBQUMsRUFBRTthQUMzRCxDQUFDO1lBQ0YsS0FBSyxHQUFHLEVBQUUsR0FBRyxLQUFLLEVBQUUsR0FBRyxNQUFNLEVBQUUsQ0FBQztTQUNuQztLQUNKO0lBQ0QsT0FBTyxLQUFLLENBQUM7QUFDakIsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFFSQ29kZVN0eWxpbmcgZnJvbSAncXItY29kZS1zdHlsaW5nJztcclxuaW1wb3J0IHsgQXN5bmNTdWJqZWN0IH0gZnJvbSAncnhqcyc7XHJcblxyXG5pbXBvcnQgeyBPcHRpb25zIH0gZnJvbSAnLi9uZ3gtcXJjb2RlLXN0eWxpbmcub3B0aW9ucyc7XHJcbmltcG9ydCB7IFRlbXBsYXRlcyB9IGZyb20gJy4vbmd4LXFyY29kZS1zdHlsaW5nLnRlbXBsYXRlcyc7XHJcblxyXG4vKipcclxuICogZHJhd1FyY29kZVxyXG4gKiBAcGFyYW0gY29uZmlnIFxyXG4gKiBAcGFyYW0gY29udGFpbmVyIFxyXG4gKiBAcmV0dXJucyBcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBkcmF3UXJjb2RlKGNvbmZpZzogT3B0aW9ucywgY29udGFpbmVyOiBIVE1MRWxlbWVudCB8IEhUTUxWaWRlb0VsZW1lbnQgfCBIVE1MQ2FudmFzRWxlbWVudCB8IFNWR0VsZW1lbnQgfCBhbnkpOiBBc3luY1N1YmplY3Q8YW55PiB7XHJcblxyXG4gICAgY29uc3Qgc3ViamVjdCA9IG5ldyBBc3luY1N1YmplY3QoKTtcclxuXHJcbiAgICAvLyBSZWplY3RcclxuICAgIGlmICghY29uZmlnIHx8ICFjb250YWluZXIpIHtcclxuICAgICAgICBzdWJqZWN0LmVycm9yKCdDb250YWluZXIgb3IgQ29uZmlnIG5vdCBhdmFpbGFibGUhJyk7XHJcbiAgICAgICAgc3ViamVjdC5jb21wbGV0ZSgpO1xyXG4gICAgICAgIHJldHVybiBzdWJqZWN0O1xyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFFSQ09ERV9OT05FX0ZSQU1FXHJcbiAgICAgKiBAcmV0dXJucyBcclxuICAgICAqL1xyXG4gICAgY29uc3QgUVJDT0RFX05PTkVfRlJBTUUgPSAoKSA9PiB7XHJcbiAgICAgICAgaWYgKGNvbmZpZz8uZnJhbWVPcHRpb25zKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zdCBlbmNvZGVDb25maWcgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgZGVlcCA9IGNvbmZpZyAmJiBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGNvbmZpZykpOyAvLyBkZWVwXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbih7IGRhdGE6ICh3aW5kb3cgYXMgYW55KS51bmVzY2FwZShlbmNvZGVVUklDb21wb25lbnQoZGVlcD8uZGF0YSA/PyAnJykpIH0sIGRlZXApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIHJlbW92ZUNoaWxkXHJcbiAgICAgICAgICAgIHdoaWxlIChjb250YWluZXIuZmlyc3RDaGlsZCkge1xyXG4gICAgICAgICAgICAgICAgY29udGFpbmVyLnJlbW92ZUNoaWxkKGNvbnRhaW5lci5sYXN0Q2hpbGQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0IENSID0gbmV3IFFSQ29kZVN0eWxpbmcoZW5jb2RlQ29uZmlnKCkgYXMgT3B0aW9ucyk7XHJcbiAgICAgICAgICAgIC8vIGFwcGVuZCB0byBjb250YWluZXJcclxuICAgICAgICAgICAgQ1IuYXBwZW5kKGNvbnRhaW5lcik7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBzdHlsZU5hbWUgPSBjb25maWc/LmZyYW1lT3B0aW9ucz8uc3R5bGUgPz8gJ0ZfMDIwJztcclxuICAgIGNvbnN0IGhlaWdodCA9IGNvbmZpZz8uZnJhbWVPcHRpb25zPy5oZWlnaHQgPz8gMzAwO1xyXG4gICAgY29uc3Qgd2lkdGggPSBjb25maWc/LmZyYW1lT3B0aW9ucz8ud2lkdGggPz8gMzAwO1xyXG4gICAgY29uc3QgeCA9IGNvbmZpZz8uZnJhbWVPcHRpb25zPy54ID8/IDUwO1xyXG4gICAgY29uc3QgeSA9IGNvbmZpZz8uZnJhbWVPcHRpb25zPy55ID8/IDUwO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogQUREX0ZSQU1FX1NWR19UT19FTEVNRU5UXHJcbiAgICAgKiBAcmV0dXJuc1xyXG4gICAgICovXHJcbiAgICBjb25zdCBBRERfRlJBTUVfU1ZHX1RPX0VMRU1FTlQgPSAoKSA9PiB7XHJcbiAgICAgICAgY29uc3QgaHR0cCA9IGZldGNoKGBodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vaWQxOTQ1L25neC1xcmNvZGUtc3R5bGluZy9tYXN0ZXIvc3ZnLyR7c3R5bGVOYW1lfS5zdmdgLCB7IG1ldGhvZDogJ0dFVCcgfSlcclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgICAgICBodHRwLnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UudGV4dCgpKS50aGVuKHJlc3VsdCA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0ICE9PSBcIjQwNDogTm90IEZvdW5kXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICB1cGdyYWRlU3ZnKHJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKHJlc3VsdCk7XHJcbiAgICAgICAgICAgIH0pLmNhdGNoKGVycm9yID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgdXBncmFkZVN2ZyA9IChyZXN1bHQ6IHN0cmluZykgPT4ge1xyXG4gICAgICAgIGNvbnN0IHBhcnNlciA9IG5ldyBET01QYXJzZXIoKTtcclxuICAgICAgICBjb25zdCBkb2MgPSBwYXJzZXIucGFyc2VGcm9tU3RyaW5nKHJlc3VsdCwgXCJpbWFnZS9zdmcreG1sXCIpO1xyXG4gICAgICAgIGlmIChkb2MpIHtcclxuICAgICAgICAgICAgY29uc3Qgc3ZnRWwgPSAoZG9jLmRvY3VtZW50RWxlbWVudC5jaGlsZHJlbiBhcyBhbnkpW3N0eWxlTmFtZSArICdfc3ZnJ107XHJcbiAgICAgICAgICAgIGlmICghc3ZnRWwpIHJldHVybjtcclxuICAgICAgICAgICAgY29uc3QgdGV4dEVscyA9IHN2Z0VsLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXCJmcmFtZS10ZXh0XCIpO1xyXG4gICAgICAgICAgICBjb25zdCBjb250ZW50RWxzID0gc3ZnRWwuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShcImZyYW1lLWNvbnRlbnRcIik7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lckVscyA9IHN2Z0VsLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXCJmcmFtZS1jb250YWluZXJcIik7XHJcbiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZVN0eWxlID0gKGVsOiBhbnksIGNvbmZpZzogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZWwpIHtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiBjb25maWcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChbJ3gnLCAneScsICd0cmFuc2Zvcm0nXSBhcyBhbnkpLmluY2x1ZGVzKGtleSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsLnNldEF0dHJpYnV0ZShrZXksIGNvbmZpZyAmJiBjb25maWdba2V5XSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoKFsndGV4dENvbnRlbnQnXSBhcyBhbnkpLmluY2x1ZGVzKGtleSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsW2tleV0gPSBjb25maWcgJiYgY29uZmlnW2tleV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbC5zdHlsZVtrZXldID0gY29uZmlnICYmIGNvbmZpZ1trZXldO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjb25zdCBjcmVhdGVFbGVtZW50TlMgPSAoY29uZmlnOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHN2Z05TID0gXCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbmV3VGV4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhzdmdOUywgXCJ0ZXh0XCIpO1xyXG4gICAgICAgICAgICAgICAgdXBkYXRlU3R5bGUobmV3VGV4dCwgY29uZmlnKTtcclxuICAgICAgICAgICAgICAgIHN2Z0VsLmFwcGVuZENoaWxkKG5ld1RleHQpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoY29uZmlnPy5mcmFtZU9wdGlvbnM/LnRleHRzKSB7XHJcbiAgICAgICAgICAgICAgICBbLi4uY29uZmlnLmZyYW1lT3B0aW9ucy50ZXh0c10uZm9yRWFjaCgodGV4dDogYW55LCBpOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBlbCA9IFsuLi50ZXh0RWxzXT8uW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgIGVsID8gdXBkYXRlU3R5bGUoZWwsIHRleHQpIDogY3JlYXRlRWxlbWVudE5TKHRleHQpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChjb25maWc/LmZyYW1lT3B0aW9ucz8uY29udGFpbmVycykge1xyXG4gICAgICAgICAgICAgICAgWy4uLmNvbnRhaW5lckVsc10uZm9yRWFjaCgoZWw6IGFueSwgaTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlU3R5bGUoZWwsIGNvbmZpZz8uZnJhbWVPcHRpb25zPy5jb250YWluZXJzPy5baV0pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChjb25maWc/LmZyYW1lT3B0aW9ucz8uY29udGVudHMpIHtcclxuICAgICAgICAgICAgICAgIFsuLi5jb250ZW50RWxzXS5mb3JFYWNoKChlbDogYW55LCBpOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB1cGRhdGVTdHlsZShlbCwgY29uZmlnPy5mcmFtZU9wdGlvbnM/LmNvbnRlbnRzPy5baV0pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGVsZW1lbnQuYXBwZW5kQ2hpbGQoZG9jLmRvY3VtZW50RWxlbWVudCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogVVBEQVRFX1BPU0lUSU9OX1FSQ09ERV9PTl9GUkFNRVxyXG4gICAgICogQHJldHVybnMgSFRNTEVsZW1lbnRcclxuICAgICAqL1xyXG4gICAgY29uc3QgVVBEQVRFX1BPU0lUSU9OX1FSQ09ERV9PTl9GUkFNRSA9ICgpID0+IHtcclxuICAgICAgICBjb25zdCBhZGRzdmcgPSBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5hZGRzdmcnKTtcclxuICAgICAgICBhZGRzdmc/LnNldEF0dHJpYnV0ZShcInRyYW5zZm9ybVwiLCBgdHJhbnNsYXRlKCR7eH0sJHt5fSlgKTtcclxuICAgICAgICByZXR1cm4gYWRkc3ZnIGFzIEhUTUxFbGVtZW50O1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogVVBEQVRFX1JPVEFURV9TQ0FMRV9RUkNPREVfT05fRlJBTUVcclxuICAgICAqIEBwYXJhbSBzdmdcclxuICAgICAqIEByZXR1cm5zIHZvaWRcclxuICAgICAqL1xyXG4gICAgY29uc3QgVVBEQVRFX1JPVEFURV9TQ0FMRV9RUkNPREVfT05fRlJBTUUgPSAoc3ZnOiBIVE1MRWxlbWVudCkgPT4ge1xyXG4gICAgICAgIGlmIChzdmcgJiYgY29uZmlnPy5yb3RhdGUpIHtcclxuICAgICAgICAgICAgc3ZnPy5jaGlsZE5vZGVzPy5bMF0/LmNoaWxkTm9kZXM/LmZvckVhY2goKG5vZGU6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKG5vZGUubm9kZU5hbWUgPT09ICdyZWN0Jykge1xyXG4gICAgICAgICAgICAgICAgICAgIG5vZGUuc3R5bGUudHJhbnNmb3JtT3JpZ2luID0gYDUwJSA1MCVgO1xyXG4gICAgICAgICAgICAgICAgICAgIG5vZGUuc3R5bGUudHJhbnNmb3JtID0gYHJvdGF0ZSgke2NvbmZpZz8ucm90YXRlID8/IDB9ZGVnKWA7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoc3ZnICYmIGNvbmZpZz8uc2NhbGUpIHtcclxuICAgICAgICAgICAgc3ZnPy5jaGlsZE5vZGVzPy5bMF0/LmNoaWxkTm9kZXM/LmZvckVhY2goKG5vZGU6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKG5vZGUubm9kZU5hbWUgPT09ICdyZWN0Jykge1xyXG4gICAgICAgICAgICAgICAgICAgIG5vZGUuc3R5bGUuc2NhbGUgPSBjb25maWc/LnNjYWxlID8/IDA7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIENSRUFURV9RUkNPREVfSU5UT19GUkFNRVxyXG4gICAgICogQHBhcmFtIGFkZHN2ZyBcclxuICAgICAqIEByZXR1cm5zIFxyXG4gICAgICovXHJcbiAgICBjb25zdCBDUkVBVEVfUVJDT0RFX0lOVE9fRlJBTUUgPSAoYWRkc3ZnOiBIVE1MRWxlbWVudCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGRlZmF1bHRDb25maWcgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIGxldCBkZWVwID0gY29uZmlnICYmIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoY29uZmlnKSk7IC8vIGRlZXBcclxuICAgICAgICAgICAgZGVlcCA9IHsgLi4uZGVlcCwgLi4ueyB0eXBlOiAnc3ZnJywgZGF0YTogKHdpbmRvdyBhcyBhbnkpLnVuZXNjYXBlKGVuY29kZVVSSUNvbXBvbmVudChkZWVwPy5kYXRhID8/ICcnKSkgfSB9O1xyXG4gICAgICAgICAgICBkZWxldGUgZGVlcC5mcmFtZU9wdGlvbnM7XHJcbiAgICAgICAgICAgIGRlbGV0ZSBkZWVwLnRlbXBsYXRlO1xyXG4gICAgICAgICAgICByZXR1cm4gZGVlcDtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gcmVtb3ZlQ2hpbGRcclxuICAgICAgICB3aGlsZSAoY29udGFpbmVyPy5maXJzdENoaWxkKSB7XHJcbiAgICAgICAgICAgIGNvbnRhaW5lci5yZW1vdmVDaGlsZChjb250YWluZXIubGFzdENoaWxkKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgQ1IgPSBuZXcgUVJDb2RlU3R5bGluZyhkZWZhdWx0Q29uZmlnKCkgYXMgT3B0aW9ucyk7XHJcbiAgICAgICAgcmV0dXJuIENSPy5fc3ZnRHJhd2luZ1Byb21pc2U/LnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICBDUi5hcHBlbmQoYWRkc3ZnKTtcclxuICAgICAgICB9KS5jYXRjaCgoZXJyb3I6IGFueSkgPT4gY29uc29sZS5lcnJvcihlcnJvcikpXHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBRUkNPREVfVFlQRV9TVkdcclxuICAgICAqIEByZXR1cm5zIFxyXG4gICAgICovXHJcbiAgICBjb25zdCBRUkNPREVfVFlQRV9TVkcgPSAoKSA9PiB7XHJcbiAgICAgICAgaWYgKGNvbmZpZz8udHlwZSA9PT0gJ3N2ZycpIHtcclxuICAgICAgICAgICAgVVBEQVRFX1NJWkVfU1ZHKCk7XHJcbiAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChlbGVtZW50KTtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIENSRUFURV9DQU5WQVNfV0lUSF9TSVpFXHJcbiAgICAgKiBAcmV0dXJucyBcclxuICAgICAqL1xyXG4gICAgY29uc3QgQ1JFQVRFX0NBTlZBU19XSVRIX1NJWkUgPSAoKSA9PiB7XHJcbiAgICAgICAgY29uc3QgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7XHJcbiAgICAgICAgY2FudmFzLmhlaWdodCA9IGhlaWdodDtcclxuICAgICAgICBjYW52YXMud2lkdGggPSB3aWR0aDtcclxuICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoY2FudmFzKTtcclxuICAgICAgICByZXR1cm4gY2FudmFzO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogRUxFTUVOVF9DT05WRVJUX1RPX0JBU0U2NFxyXG4gICAgICogQHBhcmFtIHMxIFxyXG4gICAgICogQHJldHVybnMgXHJcbiAgICAgKi9cclxuICAgIGNvbnN0IEVMRU1FTlRfQ09OVkVSVF9UT19CQVNFNjQgPSAoczE6IEhUTUxFbGVtZW50KSA9PiB7XHJcbiAgICAgICAgbGV0IGI2NCA9IFwiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxcIjtcclxuICAgICAgICBjb25zdCB4bWwgPSBzMSAmJiBuZXcgWE1MU2VyaWFsaXplcigpLnNlcmlhbGl6ZVRvU3RyaW5nKHMxKTtcclxuICAgICAgICByZXR1cm4gYjY0ICs9IHhtbCAmJiBidG9hKHVuZXNjYXBlKGVuY29kZVVSSUNvbXBvbmVudCh4bWwpKSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBVUERBVEVfU0laRV9TVkdcclxuICAgICAqIEByZXR1cm5zIFxyXG4gICAgICovXHJcbiAgICBjb25zdCBVUERBVEVfU0laRV9TVkcgPSAoKSA9PiB7XHJcbiAgICAgICAgY29uc3QgczEgPSBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoYCMke3N0eWxlTmFtZX1fc3ZnYCk7XHJcbiAgICAgICAgczEgJiYgczEuc2V0QXR0cmlidXRlKCdoZWlnaHQnLCBgJHtoZWlnaHR9cHhgKTtcclxuICAgICAgICBzMSAmJiBzMS5zZXRBdHRyaWJ1dGUoJ3dpZHRoJywgYCR7d2lkdGh9cHhgKTtcclxuICAgICAgICByZXR1cm4gczEgYXMgSFRNTEVsZW1lbnQ7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBCQVNFNjRfVE9fQkxPQlxyXG4gICAgICogQHBhcmFtIGJhc2U2NEltYWdlIFxyXG4gICAgICogQHJldHVybnMgXHJcbiAgICAgKi9cclxuICAgIGNvbnN0IEJBU0U2NF9UT19CTE9CID0gKGJhc2U2NEltYWdlOiBzdHJpbmcpID0+IHtcclxuICAgICAgICAvLyBTcGxpdCBpbnRvIHR3byBwYXJ0c1xyXG4gICAgICAgIGNvbnN0IHBhcnRzID0gYmFzZTY0SW1hZ2Uuc3BsaXQoXCI7YmFzZTY0LFwiKTtcclxuICAgICAgICAvLyBIb2xkIHRoZSBjb250ZW50IHR5cGVcclxuICAgICAgICBjb25zdCBpbWFnZVR5cGUgPSBwYXJ0c1swXS5zcGxpdChcIjpcIilbMV07XHJcbiAgICAgICAgLy8gRGVjb2RlIEJhc2U2NCBzdHJpbmdcclxuICAgICAgICBjb25zdCBkZWNvZGVkRGF0YSA9IHdpbmRvdy5hdG9iKHBhcnRzWzFdKTtcclxuICAgICAgICAvLyBDcmVhdGUgVU5JVDhBUlJBWSBvZiBzaXplIHNhbWUgYXMgcm93IGRhdGEgbGVuZ3RoXHJcbiAgICAgICAgY29uc3QgdUludDhBcnJheSA9IG5ldyBVaW50OEFycmF5KGRlY29kZWREYXRhLmxlbmd0aCk7XHJcbiAgICAgICAgLy8gSW5zZXJ0IGFsbCBjaGFyYWN0ZXIgY29kZSBpbnRvIHVJbnQ4QXJyYXlcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRlY29kZWREYXRhLmxlbmd0aDsgKytpKSB7XHJcbiAgICAgICAgICAgIHVJbnQ4QXJyYXlbaV0gPSBkZWNvZGVkRGF0YS5jaGFyQ29kZUF0KGkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBSZXR1cm4gQkxPQiBpbWFnZSBhZnRlciBjb252ZXJzaW9uXHJcbiAgICAgICAgcmV0dXJuIG5ldyBCbG9iKFt1SW50OEFycmF5XSwgeyB0eXBlOiBpbWFnZVR5cGUgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBDUkVBVEVfSU1BR0VcclxuICAgICAqL1xyXG4gICAgY29uc3QgQ1JFQVRFX0lNQUdFID0gKCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGltZyA9IG5ldyBJbWFnZSgpO1xyXG4gICAgICAgIGNvbnN0IGN0eCA9IENSRUFURV9DQU5WQVNfV0lUSF9TSVpFKCkuZ2V0Q29udGV4dChcIjJkXCIpO1xyXG4gICAgICAgIGltZy5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGN0eCAmJiBjdHguZHJhd0ltYWdlKGltZywgMCwgMCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBjb25zdCBibG9iID0gQkFTRTY0X1RPX0JMT0IoRUxFTUVOVF9DT05WRVJUX1RPX0JBU0U2NChVUERBVEVfU0laRV9TVkcoKSkpO1xyXG4gICAgICAgIGNvbnN0IGJsb2JVcmwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpO1xyXG4gICAgICAgIGltZy5zcmMgPSBibG9iVXJsO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogTUFJTlxyXG4gICAgICovXHJcbiAgICAoYXN5bmMgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmIChRUkNPREVfTk9ORV9GUkFNRSgpKSB7XHJcbiAgICAgICAgICAgIHN1YmplY3QubmV4dCh7IGNvbmZpZywgY29udGFpbmVyIH0pO1xyXG4gICAgICAgICAgICBzdWJqZWN0LmNvbXBsZXRlKCk7XHJcbiAgICAgICAgICAgIHJldHVybiAvLyBNb2RlIHFyY29kZSBiYXNpY1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGF3YWl0IEFERF9GUkFNRV9TVkdfVE9fRUxFTUVOVCgpO1xyXG4gICAgICAgICAgICBjb25zdCBBRERTVkcgPSBVUERBVEVfUE9TSVRJT05fUVJDT0RFX09OX0ZSQU1FKCk7XHJcbiAgICAgICAgICAgIGF3YWl0IENSRUFURV9RUkNPREVfSU5UT19GUkFNRShBRERTVkcpO1xyXG4gICAgICAgICAgICBVUERBVEVfUk9UQVRFX1NDQUxFX1FSQ09ERV9PTl9GUkFNRShBRERTVkcpO1xyXG4gICAgICAgICAgICBpZiAoUVJDT0RFX1RZUEVfU1ZHKCkpIHtcclxuICAgICAgICAgICAgICAgIC8vIE1vZGUgcXJjb2RlICsgZnJhbWUgdHlwZSBzdmdcclxuICAgICAgICAgICAgICAgIHN1YmplY3QubmV4dCh7IGNvbmZpZywgY29udGFpbmVyIH0pO1xyXG4gICAgICAgICAgICAgICAgc3ViamVjdC5jb21wbGV0ZSgpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8gTW9kZSBxcmNvZGUgKyBmcmFtZSB0eXBlIGNhbnZhc1xyXG4gICAgICAgICAgICAgICAgQ1JFQVRFX0lNQUdFKCk7XHJcbiAgICAgICAgICAgICAgICBzdWJqZWN0Lm5leHQoeyBjb25maWcsIGNvbnRhaW5lciB9KTtcclxuICAgICAgICAgICAgICAgIHN1YmplY3QuY29tcGxldGUoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH0pKCk7XHJcblxyXG4gICAgcmV0dXJuIHN1YmplY3Q7XHJcbn1cclxuXHJcblxyXG4vKipcclxuICogZGVmYXVsdFRlbXBsYXRlXHJcbiAqIEBwYXJhbSBjb25maWcgXHJcbiAqIEByZXR1cm5zIFxyXG4gKi9cclxuZXhwb3J0IGNvbnN0IGRlZmF1bHRUZW1wbGF0ZSA9IChjb25maWc/OiBPcHRpb25zKTogT3B0aW9ucyA9PiB7XHJcbiAgICBsZXQgZGVlcCA9IGNvbmZpZyAmJiBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGNvbmZpZykpO1xyXG4gICAgcmV0dXJuIGNvbmZpZz8udGVtcGxhdGUgPyB7IC4uLlRlbXBsYXRlcyhjb25maWcudGVtcGxhdGUudG9Mb2NhbGVMb3dlckNhc2UoKSksIC4uLmRlZXAgfSA6IGRlZXA7XHJcbn07XHJcblxyXG4vKipcclxuICogZGVlcFVwZGF0ZVxyXG4gKiBAcGFyYW0gY29uZmlnIFxyXG4gKiBAcGFyYW0gY29uZmlnVXBkYXRlIFxyXG4gKiBAcmV0dXJucyBcclxuICovXHJcbmV4cG9ydCBjb25zdCBkZWVwVXBkYXRlID0gYXN5bmMgKGNvbmZpZzogT3B0aW9ucywgY29uZmlnVXBkYXRlOiBPcHRpb25zKTogUHJvbWlzZTxPcHRpb25zPiA9PiB7XHJcbiAgICBjb25zdCBvcmlnaW4gPSBjb25maWcgJiYgSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShjb25maWcpKTtcclxuICAgIGxldCBjbG9uZSA9IHsgLi4ub3JpZ2luLCAuLi5jb25maWdVcGRhdGUgfTtcclxuICAgIGNvbnN0IGtleXMgPSBbJ2ZyYW1lT3B0aW9ucycsICdxck9wdGlvbnMnLCAnaW1hZ2VPcHRpb25zJywgJ2RvdHNPcHRpb25zJywgJ2Nvcm5lcnNTcXVhcmVPcHRpb25zJywgJ2Nvcm5lcnNEb3RPcHRpb25zJywgJ2JhY2tncm91bmRPcHRpb25zJ107XHJcbiAgICBmb3IgYXdhaXQgKGNvbnN0IGtleSBvZiBrZXlzKSB7XHJcbiAgICAgICAgaWYgKGtleSBpbiBjb25maWdVcGRhdGUpIHtcclxuICAgICAgICAgICAgY29uc3QgdXBkYXRlID0ge1xyXG4gICAgICAgICAgICAgICAgW2tleV06IHsgLi4ub3JpZ2luW2tleV0sIC4uLihjb25maWdVcGRhdGUgYXMgYW55KVtrZXldIH1cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgY2xvbmUgPSB7IC4uLmNsb25lLCAuLi51cGRhdGUgfTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gY2xvbmU7XHJcbn07XHJcbiJdfQ==